(()=>{var e={};e.id=7499,e.ids=[7499],e.modules={2846:(e,t,r)=>{"use strict";let a,s,i;r.r(t),r.d(t,{patchFetch:()=>k,routeModule:()=>x,serverHooks:()=>b,workAsyncStorage:()=>I,workUnitAsyncStorage:()=>M});var n={};r.r(n),r.d(n,{GET:()=>d});var o=r(96559),c=r(48088),u=r(37719);let p={json:(e,t)=>new Response(JSON.stringify(e),{headers:{"Content-Type":"application/json"},...t})};if("undefined"!=typeof process)try{a=r(28354),s=r(79646),i=a.promisify(s.exec)}catch(e){console.error("Error importing Node.js modules:",e)}function l(){let e="undefined"!=typeof process?process.env:{};return"preview"===e.VERCEL_ENV||"true"===e.SKIP_MONGODB||"development"===e.NODE_ENV}function m(){return{cpu:{usage:Math.round(100*Math.random())},memory:{total:8192,used:Math.round(4096*Math.random()),free:4096},storage:{total:32768,used:Math.round(16384*Math.random()),free:16384},temperature:{cpu:Math.round(40+20*Math.random())},uptime:{days:3,hours:7,minutes:45},services:[{name:"can0-interface",status:"active",description:"CAN0 Interface Setup"},{name:"influxdb",status:"inactive",description:"InfluxDB Time Series Database"},{name:"mongod",status:"active",description:"MongoDB Database Server"},{name:"grafana-server",status:"active",description:"Grafana Dashboard"},{name:"nginx",status:"active",description:"Web Server"},{name:"webmin",status:"inactive",description:"Webmin Administration"}]}}async function d(e){try{if(l())return p.json({success:!0,metrics:m()},{status:200});let e=await f(),t=await g(),r=await h(),a=await y(),s=await v(),i=await w();return p.json({success:!0,metrics:{cpu:{usage:e},memory:t,storage:r,temperature:{cpu:a},uptime:s,services:i}},{status:200})}catch(e){return console.error("Error fetching system metrics:",e),p.json({success:!0,metrics:m()},{status:200})}}async function f(){try{try{let{stdout:e}=await i("top -bn1 | grep '%Cpu(s)' | awk '{print $2 + $4}'");if(e&&e.trim())return parseFloat(e.trim())||0}catch(e){}try{let{stdout:e}=await i("grep 'cpu ' /proc/stat | awk '{usage=($2+$4)*100/($2+$4+$5)} END {print usage}'");if(e&&e.trim())return parseFloat(e.trim())||0}catch(e){}return 0}catch(e){return console.error("Failed to get CPU usage:",e),0}}async function h(){try{function e(e){if(!e)return 0;let t=e.match(/([\d.]+)/),r=t&&t[1]?parseFloat(t[1]):0,a=e.toUpperCase().includes("G"),s=e.toUpperCase().includes("M"),i=e.toUpperCase().includes("K");return a?r:s?r/1024:i?r/1048576:r}try{let{stdout:t}=await i('df -h / | tail -1 | awk \'{print $2" "$3" "$4}\'');if(t&&t.trim()){let r=t.trim().split(" ");if(r.length>=3)return{total:e(r[0]),used:e(r[1]),free:e(r[2])}}}catch(e){console.log("First df approach failed:",e)}try{let{stdout:e}=await i('df -B1 / | tail -1 | awk \'{print $2" "$3" "$4}\'');if(e&&e.trim()){let t=e.trim().split(" ");if(t.length>=3)return{total:parseInt(t[0],10)/0x40000000||0,used:parseInt(t[1],10)/0x40000000||0,free:parseInt(t[2],10)/0x40000000||0}}}catch(e){console.log("Second df approach failed:",e)}return console.log("All storage info approaches failed"),{total:0,used:0,free:0}}catch(e){return console.error("Failed to get storage info:",e),{total:0,used:0,free:0}}}async function g(){try{try{let{stdout:e}=await i("free -m | grep 'Mem:'");if(e&&e.trim()){let t=e.trim().split(/\s+/);if(t.length>=4)return{total:parseInt(t[1],10)||0,used:parseInt(t[2],10)||0,free:parseInt(t[3],10)||0}}}catch(e){}try{let{stdout:e}=await i("cat /proc/meminfo | grep MemTotal | awk '{print $2}'"),{stdout:t}=await i("cat /proc/meminfo | grep MemFree | awk '{print $2}'");if(e&&t){let r=parseInt(e.trim(),10)/1024||0,a=parseInt(t.trim(),10)/1024||0;return{total:r,used:r-a,free:a}}}catch(e){}return{total:0,used:0,free:0}}catch(e){return console.error("Failed to get memory info:",e),{total:0,used:0,free:0}}}async function y(){try{try{let{stdout:e}=await i("vcgencmd measure_temp");if(e&&e.trim()){let t=e.match(/([\d.]+)/);if(t&&t[1])return parseFloat(t[1])||0}}catch(e){}try{let{stdout:e}=await i("cat /sys/class/thermal/thermal_zone0/temp");if(e&&e.trim())return Math.round(parseInt(e.trim(),10)/1e3)||0}catch(e){}return 0}catch(e){return console.error("Failed to get CPU temperature:",e),0}}async function v(){try{let e=0,t=0,r=0;try{let{stdout:a}=await i("uptime -p");if(a&&a.trim()){let s=a.trim(),i=s.match(/([0-9]+)\s+day/),n=s.match(/([0-9]+)\s+hour/),o=s.match(/([0-9]+)\s+minute/);return i&&(e=parseInt(i[1],10)),n&&(t=parseInt(n[1],10)),o&&(r=parseInt(o[1],10)),{days:e,hours:t,minutes:r}}}catch(e){console.log("uptime -p command failed:",e)}try{let{stdout:a}=await i("cat /proc/uptime");if(a&&a.trim()){let s=parseFloat(a.split(" ")[0]);return e=Math.floor(s/86400),t=Math.floor(s%86400/3600),r=Math.floor(s%3600/60),{days:e,hours:t,minutes:r}}}catch(e){console.log("/proc/uptime approach failed:",e)}try{let{stdout:a}=await i("uptime");if(a&&a.trim()){let s=a.split("up ")[1]?.split(",")?.[0]||"";if(s.includes("day")){let a=s.split("day");e=parseInt(a[0].trim(),10)||0;let i=a[1]?.trim()||"";if(i.includes(":")){let[e,a]=i.split(":").map(e=>e.trim());t=parseInt(e,10)||0,r=parseInt(a,10)||0}}else if(s.includes(":")){let[e,a]=s.split(":").map(e=>e.trim());t=parseInt(e,10)||0,r=parseInt(a,10)||0}return{days:e,hours:t,minutes:r}}}catch(e){console.log("uptime command failed:",e)}return{days:0,hours:0,minutes:0}}catch(e){return console.error("Failed to get system uptime:",e),{days:0,hours:0,minutes:0}}}async function w(){if(l())return m().services||[];try{let e=[],t={"can0-interface":"CAN0 Interface Setup",influxdb:"InfluxDB Time Series Database",mongod:"MongoDB Database Server","grafana-server":"Grafana Dashboard",nginx:"Web Server",webmin:"Webmin Administration"};for(let r of["can0-interface","influxdb","mongod","grafana-server","nginx","webmin"])try{let{stdout:a}=await i(`systemctl is-active ${r}`),s=a.trim(),n="unknown";"active"===s?n="active":"inactive"===s?n="inactive":"failed"===s?n="failed":"activating"===s&&(n="activating"),e.push({name:r,status:n,description:t[r]||r})}catch(a){e.push({name:r,status:"unknown",description:t[r]||r})}return e}catch(e){return console.error("Failed to get system services:",e),[]}}let x=new o.AppRouteRouteModule({definition:{kind:c.RouteKind.APP_ROUTE,page:"/api/system/metrics/route",pathname:"/api/system/metrics",filename:"route",bundlePath:"app/api/system/metrics/route"},resolvedPagePath:"C:\\Users\\Mtlantla\\Desktop\\EmberCore\\Dev_RP3_c\\Node-APPS\\iot-application\\app\\api\\system\\metrics\\route.ts",nextConfigOutput:"",userland:n}),{workAsyncStorage:I,workUnitAsyncStorage:M,serverHooks:b}=x;function k(){return(0,u.patchFetch)({workAsyncStorage:I,workUnitAsyncStorage:M})}},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},28354:e=>{"use strict";e.exports=require("util")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},78335:()=>{},79646:e=>{"use strict";e.exports=require("child_process")},96487:()=>{},96559:(e,t,r)=>{"use strict";e.exports=r(44870)}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[7719],()=>r(2846));module.exports=a})();